clear all; close all; clc

% Search a grid of parameters, including:
% low-pass filter cutoff frequency (ranging from 0.1:10)
% mu_x  (Friction parameter) (ranging from 0.1:1)
% mu_y  (Friction parameter) (ranging from 0.1:1)
% K     (From Liu et al.) (centered around 13.333)
% f_r   (From Liu et al.) (centered around 0.0263)

% TODO: Don't need to run 'matlab_import_data' at every timestep
% TODO: Could disable plotting with a function input

% The best parameter set will return the lowest variance
results = [];
row = 1;
SSE = 0;
variance = 0;
for (cutoff_freq = 0.1:0.2:10)
    for (mu_x = 0.1) %:0.05:1)
        for (mu_y = 0.1) %:0.05:1)
            for (K = 5) %:0.5:20)
                for (f_r = 0.005 : 0.005 : 0.01) %0.06)
                    row % Track which iteration we're on
                    
                    % Store the parameters and variance for plotting
                    %function [ variance ] = compare_sim_to_data( cutoff_frequency )
                    [SSE num_samples] = compare_sim_to_data(cutoff_freq, mu_x, mu_y, K, f_r);
                    variance = SSE/num_samples;
                    results(row,:) = [cutoff_freq mu_x mu_y K f_r variance];
                    
                    row = row+1;
                    clearvars -global;
                    clearvars -except results row cutoff_freq mu_x mu_y K f_r;
                    close all; clc
                end
            end
        end
    end
end

% Sort from most to least variance
% The best: smallest variance with at least X datapoints
min_samples = 50;
results = sort( results,  );
[min_variance, min_index] = min(results(:,6));
min_variance
min_index

% Run it one more time to see the best results
% We're pulling these inputs from the "best row" of results
compare_sim_to_data( results(min_index, 1), results(min_index, 2), results(min_index, 3), results(min_index, 4), results(min_index, 5));


